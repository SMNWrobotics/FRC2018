package org.usfirst.frc1982.the2018Bot.commands;
import org.usfirst.frc1982.the2018Bot.Robot;
import org.usfirst.frc1982.the2018Bot.RobotMap;

import edu.wpi.first.wpilibj.command.Command;
import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import jaci.pathfinder.Pathfinder;
import jaci.pathfinder.Trajectory;
import jaci.pathfinder.Trajectory.Segment;
import jaci.pathfinder.followers.EncoderFollower;

public class AutoSMidGLeft extends Command {
		
//		new Waypoint(0,0,0),
//		new Waypoint(105.5,62.0,0.0)
		
		EncoderFollower left;
		EncoderFollower right;
		
		@Override
		protected void initialize() {
			Trajectory trajectory;
			double max_velocity = 100; 
			
			trajectory = new Trajectory(segs); 
			
			
			
			
			
		}
		
		@Override
		protected void execute() {
			//7.44 is magic number determined by rotating wheel about 1 revolution
			int lpos = (int) Math.round(RobotMap.driveLeft.getSelectedSensorPosition(0));
			int rpos = (int) Math.round(RobotMap.driveRight.getSelectedSensorPosition(0));
			double l = left.calculate(lpos);
		    double r = right.calculate(rpos);
		    
		    double turn = 0.0;
		    double gyro_heading = -Robot.gyro.getAngleZ()/4; // Assuming the gyro is giving a value in degrees
		    if (Robot.gyroValid) {
			    double desired_heading = Pathfinder.r2d(left.getHeading());  // Should also be in degrees
			    
			    double angleDifference = Pathfinder.boundHalfDegrees(desired_heading - gyro_heading);
			    turn = 0.8 * (-1.0/80.0) * angleDifference;
			    
			    SmartDashboard.putNumber("Gyro Angle", gyro_heading);
			    SmartDashboard.putNumber("Desired Heading", desired_heading);
		    }
		    System.out.println("Lencoder: " + (lpos/30759*6) + " Rencoder: " + rpos + " Left output: " + l + " Right output: " + r);// + " desired heading: " + desired_heading);
		    
		    RobotMap.driveLeft.set(l + turn);
		    RobotMap.driveleftSlave.set(l + turn);
		    RobotMap.driveRight.set(r - turn);
	    	RobotMap.driverightSlave.set(r - turn);
		}
		
		@Override
		protected boolean isFinished() {
			// TODO Auto-generated method stub
			return false;
		}
		
		@Override
		protected void end() {
			
		}
		
		@Override
		protected void interrupted() {
			
		}
		
		private Segment[] segs = {
				new Segment(0.050000,0.001658,0.000000,0.003077,0.123097,2.461943,49.238854,0.000031),
				new Segment(0.050000,0.013968,0.000002,0.015387,0.369291,4.923885,49.238854,0.000258),
				new Segment(0.050000,0.041665,0.000016,0.043084,0.738583,7.385828,49.238854,0.000770),
				new Segment(0.050000,0.090903,0.000076,0.092323,1.230971,9.847771,49.238854,0.001680),
				new Segment(0.050000,0.167839,0.000260,0.169259,1.846457,12.309713,49.238854,0.003104),
				new Segment(0.050000,0.278625,0.000718,0.280046,2.585040,14.771656,49.238854,0.005158),
				new Segment(0.050000,0.426339,0.001683,0.427763,3.323623,14.771656,0.000000,0.007903),
				new Segment(0.050000,0.610976,0.003459,0.612408,4.062205,14.771656,-0.000000,0.011345),
				new Segment(0.050000,0.832531,0.006432,0.833983,4.800788,14.771656,0.000000,0.015490),
				new Segment(0.050000,1.090993,0.011063,1.092487,5.539371,14.771656,0.000000,0.020347),
				new Segment(0.050000,1.386346,0.017897,1.387920,6.277954,14.771656,-0.000000,0.025923),
				new Segment(0.050000,1.718568,0.027558,1.720282,7.016537,14.771656,0.000000,0.032230),
				new Segment(0.050000,2.087622,0.040758,2.089574,7.755119,14.771656,0.000000,0.039278),
				new Segment(0.050000,2.493463,0.058291,2.495794,8.493702,14.771656,0.000000,0.047078),
				new Segment(0.050000,2.936027,0.081039,2.938944,9.232285,14.771656,-0.000000,0.055644),
				new Segment(0.050000,3.415232,0.109975,3.419023,9.970868,14.771656,0.000000,0.064987),
				new Segment(0.050000,3.930970,0.146160,3.936031,10.709451,14.771656,0.000000,0.075120),
				new Segment(0.050000,4.483106,0.190749,4.489968,11.448033,14.771656,0.000000,0.086054),
				new Segment(0.050000,5.071475,0.244985,5.080834,12.186616,14.771656,0.000000,0.097802),
				new Segment(0.050000,5.695869,0.310208,5.708630,12.925199,14.771656,-0.000000,0.110373),
				new Segment(0.050000,6.356039,0.387847,6.373354,13.663782,14.771656,0.000000,0.123776),
				new Segment(0.050000,7.051685,0.479423,7.075008,14.402365,14.771656,0.000000,0.138017),
				new Segment(0.050000,7.782451,0.586545,7.813591,15.140947,14.771656,-0.000000,0.153100),
				new Segment(0.050000,8.547918,0.710904,8.589103,15.879530,14.771656,-0.000000,0.169023),
				new Segment(0.050000,9.347600,0.854273,9.401544,16.618113,14.771656,0.000000,0.185783),
				new Segment(0.050000,10.180932,1.018494,10.250914,17.356696,14.771656,0.000000,0.203370),
				new Segment(0.050000,11.047271,1.205472,11.137213,18.095279,14.771656,-0.000000,0.221767),
				new Segment(0.050000,11.945887,1.417166,12.060442,18.833862,14.771656,0.000000,0.240953),
				new Segment(0.050000,12.875960,1.655571,13.020599,19.572444,14.771656,0.000000,0.260896),
				new Segment(0.050000,13.836577,1.922706,14.017686,20.311027,14.771656,0.000000,0.281560),
				new Segment(0.050000,14.826734,2.220596,15.051702,21.049610,14.771656,-0.000000,0.302896),
				new Segment(0.050000,15.845333,2.551252,16.122647,21.788193,14.771656,0.000000,0.324849),
				new Segment(0.050000,16.891190,2.916651,17.230521,22.526776,14.771656,-0.000000,0.347352),
				new Segment(0.050000,17.963040,3.318714,18.375325,23.265358,14.771656,0.000000,0.370332),
				new Segment(0.050000,19.059547,3.759282,19.557057,24.003941,14.771656,0.000000,0.393705),
				new Segment(0.050000,20.179317,4.240096,20.775719,24.742524,14.771656,-0.000000,0.417378),
				new Segment(0.050000,21.320913,4.762774,22.031310,25.481107,14.771656,0.000000,0.441253),
				new Segment(0.050000,22.482874,5.328790,23.323829,26.219690,14.771656,0.000000,0.465224),
				new Segment(0.050000,23.663735,5.939460,24.653279,26.958272,14.771656,0.000000,0.489183),
				new Segment(0.050000,24.862050,6.595922,26.019657,27.696855,14.771656,0.000000,0.513017),
				new Segment(0.050000,26.076414,7.299129,27.422964,28.435438,14.771656,-0.000000,0.536612),
				new Segment(0.050000,27.305488,8.049837,28.863201,29.174021,14.771656,0.000000,0.559855),
				new Segment(0.050000,28.548023,8.848606,30.340366,29.912604,14.771656,0.000000,0.582635),
				new Segment(0.050000,29.802878,9.695794,31.854461,30.651186,14.771656,0.000000,0.604846),
				new Segment(0.050000,31.069045,10.591563,33.405485,31.389769,14.771656,0.000000,0.626385),
				new Segment(0.050000,32.345667,11.535883,34.993438,32.128352,14.771656,-0.000000,0.647155),
				new Segment(0.050000,33.632052,12.528541,36.618320,32.866935,14.771656,0.000000,0.667065),
				new Segment(0.050000,34.927688,13.569147,38.280131,33.605518,14.771656,-0.000000,0.686033),
				new Segment(0.050000,36.232257,14.657146,39.978872,34.344100,14.771656,0.000000,0.703980),
				new Segment(0.050000,37.545639,15.791829,41.714541,35.082683,14.771656,0.000000,0.720835),
				new Segment(0.050000,38.867925,16.972338,43.487140,35.821266,14.771656,-0.000000,0.736533),
				new Segment(0.050000,40.199423,18.197674,45.296668,36.559849,14.771656,0.000000,0.751013),
				new Segment(0.050000,41.540657,19.466707,47.143125,37.298432,14.771656,0.000000,0.764216),
				new Segment(0.050000,42.892379,20.778175,49.026511,38.037014,14.771656,-0.000000,0.776087),
				new Segment(0.050000,44.255572,22.130685,50.946826,38.775597,14.771656,0.000000,0.786573),
				new Segment(0.050000,45.631451,23.522711,52.904071,39.514180,14.771656,0.000000,0.795618),
				new Segment(0.050000,47.019335,24.950374,54.895167,40.129666,12.309713,-49.238854,0.803156),
				new Segment(0.050000,48.416722,26.407365,56.913960,40.622054,9.847771,-49.238854,0.809118),
				new Segment(0.050000,49.821419,27.887158,58.954295,40.991346,7.385828,-49.238854,0.813453),
				new Segment(0.050000,51.231479,29.383059,61.010017,41.237540,4.923885,-49.238854,0.816122),
				new Segment(0.050000,52.645130,30.888260,63.074972,41.360637,2.461943,-49.238854,0.817100),
				new Segment(0.050000,54.058901,32.393970,65.140380,41.255699,-2.098767,-91.214184,0.816375),
				new Segment(0.050000,55.469330,33.891395,67.197464,41.027663,-4.560709,-49.238854,0.813956),
				new Segment(0.050000,56.874662,35.373714,69.240069,40.676531,-7.022652,-49.238854,0.809868),
				new Segment(0.050000,58.272979,36.834216,71.262040,40.202301,-9.484595,-49.238854,0.804146),
				new Segment(0.050000,59.662128,38.266346,73.257221,39.604974,-11.946537,-49.238854,0.796840),
				new Segment(0.050000,61.039655,39.663763,75.219460,38.884550,-14.408480,-49.238854,0.788017),
				new Segment(0.050000,62.404610,41.022229,77.145223,38.145967,-14.771656,-7.263523,0.777744),
				new Segment(0.050000,63.757927,42.339873,79.034056,37.407384,-14.771656,-0.000000,0.766077),
				new Segment(0.050000,65.100622,43.615283,80.885961,36.668802,-14.771656,0.000000,0.753070),
				new Segment(0.050000,66.433481,44.847179,82.700936,35.930219,-14.771656,-0.000000,0.738778),
				new Segment(0.050000,67.757063,46.034410,84.478983,35.191636,-14.771656,0.000000,0.723260),
				new Segment(0.050000,69.071707,47.175957,86.220100,34.453053,-14.771656,0.000000,0.706574),
				new Segment(0.050000,70.377535,48.270942,87.924288,33.714470,-14.771656,-0.000000,0.688787),
				new Segment(0.050000,71.674460,49.318633,89.591547,32.975888,-14.771656,0.000000,0.669968),
				new Segment(0.050000,72.962192,50.318451,91.221877,32.237305,-14.771656,0.000000,0.650195),
				new Segment(0.050000,74.240247,51.269981,92.815278,31.498722,-14.771656,-0.000000,0.629549),
				new Segment(0.050000,75.507960,52.172984,94.371749,30.760139,-14.771656,0.000000,0.608121),
				new Segment(0.050000,76.764497,53.027401,95.891292,30.021556,-14.771656,-0.000000,0.586006),
				new Segment(0.050000,78.008872,53.833366,97.373905,29.282974,-14.771656,0.000000,0.563306),
				new Segment(0.050000,79.239963,54.591208,98.819589,28.544391,-14.771656,0.000000,0.540126),
				new Segment(0.050000,80.456535,55.301455,100.228344,27.805808,-14.771656,-0.000000,0.516579),
				new Segment(0.050000,81.657261,55.964836,101.600170,27.067225,-14.771656,0.000000,0.492776),
				new Segment(0.050000,82.840746,56.582273,102.935066,26.328642,-14.771656,0.000000,0.468830),
				new Segment(0.050000,84.005547,57.154879,104.233034,25.590060,-14.771656,-0.000000,0.444856),
				new Segment(0.050000,85.150202,57.683941,105.494072,24.851477,-14.771656,0.000000,0.420961),
				new Segment(0.050000,86.273247,58.170914,106.718182,24.112894,-14.771656,-0.000000,0.397253),
				new Segment(0.050000,87.373242,58.617393,107.905362,23.374311,-14.771656,0.000000,0.373832),
				new Segment(0.050000,88.448784,59.025103,109.055613,22.635728,-14.771656,-0.000000,0.350790),
				new Segment(0.050000,89.498529,59.395871,110.168935,21.897146,-14.771656,-0.000000,0.328212),
				new Segment(0.050000,90.521200,59.731607,111.245327,21.158563,-14.771656,0.000000,0.306174),
				new Segment(0.050000,91.515600,60.034282,112.284791,20.419980,-14.771656,-0.000000,0.284744),
				new Segment(0.050000,92.480619,60.305901,113.287325,19.681397,-14.771656,0.000000,0.263978),
				new Segment(0.050000,93.415238,60.548490,114.252931,18.942814,-14.771656,0.000000,0.243926),
				new Segment(0.050000,94.318532,60.764068,115.181607,18.204232,-14.771656,0.000000,0.224626),
				new Segment(0.050000,95.189665,60.954636,116.073354,17.465649,-14.771656,0.000000,0.206111),
				new Segment(0.050000,96.027896,61.122158,116.928172,16.727066,-14.771656,0.000000,0.188403),
				new Segment(0.050000,96.832568,61.268547,117.746060,15.988483,-14.771656,0.000000,0.171520),
				new Segment(0.050000,97.603105,61.395656,118.527020,15.249900,-14.771656,-0.000000,0.155473),
				new Segment(0.050000,98.339010,61.505269,119.271050,14.511318,-14.771656,0.000000,0.140266),
				new Segment(0.050000,99.039853,61.599088,119.978152,13.772735,-14.771656,-0.000000,0.125900),
				new Segment(0.050000,99.705271,61.678736,120.648324,13.034152,-14.771656,-0.000000,0.112373),
				new Segment(0.050000,100.334954,61.745746,121.281567,12.295569,-14.771656,0.000000,0.099679),
				new Segment(0.050000,100.928646,61.801561,121.877881,11.556986,-14.771656,-0.000000,0.087810),
				new Segment(0.050000,101.486136,61.847533,122.437266,10.818404,-14.771656,0.000000,0.076756),
				new Segment(0.050000,102.007250,61.884921,122.959721,10.079821,-14.771656,0.000000,0.066505),
				new Segment(0.050000,102.491848,61.914893,123.445248,9.341238,-14.771656,0.000000,0.057046),
				new Segment(0.050000,102.939822,61.938523,123.893845,8.602655,-14.771656,0.000000,0.048366),
				new Segment(0.050000,103.351083,61.956797,124.305513,7.864072,-14.771656,-0.000000,0.040453),
				new Segment(0.050000,103.725566,61.970611,124.680252,7.125489,-14.771656,0.000000,0.033294),
				new Segment(0.050000,104.063223,61.980771,125.018062,6.386907,-14.771656,-0.000000,0.026878),
				new Segment(0.050000,104.364016,61.988002,125.318943,5.648324,-14.771656,0.000000,0.021194),
				new Segment(0.050000,104.627922,61.992941,125.582894,4.909741,-14.771656,-0.000000,0.016232),
				new Segment(0.050000,104.854921,61.996143,125.809917,4.171158,-14.771656,0.000000,0.011982),
				new Segment(0.050000,105.045005,61.998083,126.000010,3.432575,-14.771656,0.000000,0.008437),
				new Segment(0.050000,105.198165,61.999157,126.153174,2.693993,-14.771656,-0.000000,0.005589),
				new Segment(0.050000,105.314399,61.999682,126.269410,1.955410,-14.771656,0.000000,0.003433),
				new Segment(0.050000,105.396328,61.999901,126.351339,1.321765,-12.672890,41.975331,0.001916),
				new Segment(0.050000,105.449652,61.999977,126.404663,0.811218,-10.210947,49.238854,0.000930),
				new Segment(0.050000,105.480527,61.999996,126.435538,0.423768,-7.749004,49.238854,0.000360),
				new Segment(0.050000,105.495107,62.000000,126.450118,0.159415,-5.287062,49.238854,0.000090),
				new Segment(0.050000,105.499546,62.000000,126.454557,0.018159,-2.825119,49.238854,0.000008),
				new Segment(0.050000,105.500000,62.000000,126.455011,0.000000,-0.363176,49.238854,6.283185),
				new Segment(0.050000,105.500000,62.000000,126.455011,0.000000,0.000000,7.263523,6.283185)
		};
}

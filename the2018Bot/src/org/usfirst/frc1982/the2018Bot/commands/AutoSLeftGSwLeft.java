package org.usfirst.frc1982.the2018Bot.commands;

import org.usfirst.frc1982.the2018Bot.Robot;
import org.usfirst.frc1982.the2018Bot.RobotMap;

import edu.wpi.first.wpilibj.command.Command;
import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import jaci.pathfinder.Pathfinder;
import jaci.pathfinder.Trajectory;
import jaci.pathfinder.Trajectory.Segment;
import jaci.pathfinder.followers.EncoderFollower;
import jaci.pathfinder.modifiers.TankModifier;

public class AutoSLeftGSwLeft extends Command {
	
//	new Waypoint(0.0, 0.0, 0.0),
//	new Waypoint(50.0,0.0,0.0),
//	new Waypoint(75.0,0.0,0.0),
//	new Waypoint(100.0,0.0,0.0),
//	new Waypoint(151.5,-29.06,Pathfinder.d2r(90))
	
	EncoderFollower left;
	EncoderFollower right;
	
	@Override
	protected void initialize() {
		Trajectory trajectory;
		double max_velocity = 100; 
		
		trajectory = new Trajectory(segs); 
		// Wheelbase Width is the distance from the left wheel to the right wheel, in this case 25.5 (inches)
		
		EncoderFollower[] result = AutoUtil.getPath(trajectory, max_velocity);
		
		left = result[0];
		right = result[1];
	}
	
	@Override
	protected void execute() {
		//7.44 is magic number determined by rotating wheel about 1 revolution
		int lpos = (int) Math.round(RobotMap.driveLeft.getSelectedSensorPosition(0));
		int rpos = (int) Math.round(RobotMap.driveRight.getSelectedSensorPosition(0));
		double l = left.calculate(lpos);
	    double r = right.calculate(rpos);
	    
	    double turn = 0.0;
	    double gyro_heading = -Robot.gyro.getAngleZ()/4; // Assuming the gyro is giving a value in degrees
	    if (Robot.gyroValid) {
		    double desired_heading = Pathfinder.r2d(left.getHeading());  // Should also be in degrees
		    
		    double angleDifference = Pathfinder.boundHalfDegrees(desired_heading - gyro_heading);
		    turn = 0.8 * (-1.0/80.0) * angleDifference;
		    
		    SmartDashboard.putNumber("Gyro Angle", gyro_heading);
		    SmartDashboard.putNumber("Desired Heading", desired_heading);
	    }
	    System.out.println("Lencoder: " + (lpos/30759*6) + " Rencoder: " + rpos + " Left output: " + l + " Right output: " + r);// + " desired heading: " + desired_heading);
	    
	    RobotMap.driveLeft.set(l + turn);
//	    RobotMap.driveleftSlave.set(l + turn);
	    RobotMap.driveRight.set(r - turn);
//    	RobotMap.driverightSlave.set(r - turn);
	}
	
	@Override
	protected boolean isFinished() {
		return false;
	}
	
	@Override
	protected void end() {
		
	}
	
	@Override
	protected void interrupted() {
		
	}
	
	private Segment[] segs = {
			new Segment(0.050000,0.002614,0.000000,0.003114,0.124548,2.490965,49.819304,0.000000),
			new Segment(0.050000,0.015069,0.000000,0.015569,0.373645,4.981930,49.819304,0.000000),
			new Segment(0.050000,0.043092,0.000000,0.043592,0.747290,7.472896,49.819304,0.000000),
			new Segment(0.050000,0.092911,0.000000,0.093411,1.245483,9.963861,49.819304,0.000000),
			new Segment(0.050000,0.170754,0.000000,0.171254,1.868224,12.454826,49.819304,0.000000),
			new Segment(0.050000,0.282847,0.000000,0.283347,2.615513,14.945791,49.819304,0.000000),
			new Segment(0.050000,0.432305,0.000000,0.432805,3.362803,14.945791,-0.000000,0.000000),
			new Segment(0.050000,0.619128,0.000000,0.619628,4.110093,14.945791,0.000000,0.000000),
			new Segment(0.050000,0.843314,0.000000,0.843814,4.857382,14.945791,0.000000,0.000000),
			new Segment(0.050000,1.104866,0.000000,1.105366,5.604672,14.945791,-0.000000,0.000000),
			new Segment(0.050000,1.403782,0.000000,1.404282,6.351961,14.945791,0.000000,0.000000),
			new Segment(0.050000,1.740062,0.000000,1.740562,7.099251,14.945791,-0.000000,0.000000),
			new Segment(0.050000,2.113707,0.000000,2.114207,7.846540,14.945791,0.000000,0.000000),
			new Segment(0.050000,2.524716,0.000000,2.525216,8.593830,14.945791,-0.000000,0.000000),
			new Segment(0.050000,2.973090,0.000000,2.973590,9.341119,14.945791,0.000000,0.000000),
			new Segment(0.050000,3.458828,0.000000,3.459328,10.088409,14.945791,0.000000,0.000000),
			new Segment(0.050000,3.981931,0.000000,3.982431,10.835699,14.945791,-0.000000,0.000000),
			new Segment(0.050000,4.542398,0.000000,4.542898,11.582988,14.945791,0.000000,0.000000),
			new Segment(0.050000,5.140229,0.000000,5.140729,12.330278,14.945791,-0.000000,0.000000),
			new Segment(0.050000,5.775426,0.000000,5.775926,13.077567,14.945791,0.000000,0.000000),
			new Segment(0.050000,6.447986,0.000000,6.448486,13.824857,14.945791,-0.000000,0.000000),
			new Segment(0.050000,7.157911,0.000000,7.158411,14.572146,14.945791,0.000000,0.000000),
			new Segment(0.050000,7.905201,0.000000,7.905701,15.319436,14.945791,-0.000000,0.000000),
			new Segment(0.050000,8.689855,0.000000,8.690355,16.066725,14.945791,0.000000,0.000000),
			new Segment(0.050000,9.511873,0.000000,9.512373,16.814015,14.945791,0.000000,0.000000),
			new Segment(0.050000,10.371256,0.000000,10.371756,17.561305,14.945791,-0.000000,0.000000),
			new Segment(0.050000,11.268004,0.000000,11.268504,18.308594,14.945791,0.000000,0.000000),
			new Segment(0.050000,12.202116,0.000000,12.202616,19.055884,14.945791,0.000000,0.000000),
			new Segment(0.050000,13.173592,0.000000,13.174092,19.803173,14.945791,0.000000,0.000000),
			new Segment(0.050000,14.182433,0.000000,14.182933,20.550463,14.945791,-0.000000,0.000000),
			new Segment(0.050000,15.228638,0.000000,15.229138,21.297752,14.945791,0.000000,0.000000),
			new Segment(0.050000,16.312208,0.000000,16.312708,22.045042,14.945791,0.000000,0.000000),
			new Segment(0.050000,17.433143,0.000000,17.433643,22.792331,14.945791,0.000000,0.000000),
			new Segment(0.050000,18.591441,0.000000,18.591941,23.539621,14.945791,-0.000000,0.000000),
			new Segment(0.050000,19.787105,0.000000,19.787605,24.286911,14.945791,0.000000,0.000000),
			new Segment(0.050000,21.020132,0.000000,21.020632,25.034200,14.945791,0.000000,0.000000),
			new Segment(0.050000,22.290525,0.000000,22.291025,25.781490,14.945791,-0.000000,0.000000),
			new Segment(0.050000,23.598281,0.000000,23.598781,26.528779,14.945791,0.000000,0.000000),
			new Segment(0.050000,24.943403,0.000000,24.943903,27.276069,14.945791,0.000000,0.000000),
			new Segment(0.050000,26.325888,0.000000,26.326388,28.023358,14.945791,-0.000000,0.000000),
			new Segment(0.050000,27.745738,0.000000,27.746238,28.770648,14.945791,-0.000000,0.000000),
			new Segment(0.050000,29.202953,0.000000,29.203453,29.517937,14.945791,0.000000,0.000000),
			new Segment(0.050000,30.697532,0.000000,30.698032,30.265227,14.945791,0.000000,0.000000),
			new Segment(0.050000,32.229476,0.000000,32.229976,31.012517,14.945791,-0.000000,0.000000),
			new Segment(0.050000,33.798784,0.000000,33.799284,31.759806,14.945791,-0.000000,0.000000),
			new Segment(0.050000,35.405456,0.000000,35.405956,32.507096,14.945791,0.000000,0.000000),
			new Segment(0.050000,37.049493,0.000000,37.049993,33.254385,14.945791,-0.000000,0.000000),
			new Segment(0.050000,38.730895,0.000000,38.731395,34.001675,14.945791,0.000000,0.000000),
			new Segment(0.050000,40.449661,0.000000,40.450161,34.748964,14.945791,-0.000000,0.000000),
			new Segment(0.050000,42.205791,0.000000,42.206291,35.496254,14.945791,0.000000,0.000000),
			new Segment(0.050000,43.999286,0.000000,43.999786,36.243543,14.945791,0.000000,0.000000),
			new Segment(0.050000,45.830146,0.000000,45.830646,36.990833,14.945791,-0.000000,0.000000),
			new Segment(0.050000,47.698370,0.000000,47.698870,37.738123,14.945791,0.000000,0.000000),
			new Segment(0.050000,49.603958,0.000000,49.604458,38.485412,14.945791,0.000000,0.000000),
			new Segment(0.050000,51.546661,0.000000,51.547411,39.232702,14.945791,-0.000000,0.000000),
			new Segment(0.050000,53.526978,0.000000,53.527728,39.979991,14.945791,0.000000,0.000000),
			new Segment(0.050000,55.544660,0.000000,55.545410,40.727281,14.945791,-0.000000,0.000000),
			new Segment(0.050000,57.599706,0.000000,57.600456,41.474570,14.945791,-0.000000,0.000000),
			new Segment(0.050000,59.692117,0.000000,59.692867,42.221860,14.945791,0.000000,0.000000),
			new Segment(0.050000,61.821892,0.000000,61.822642,42.969149,14.945791,0.000000,0.000000),
			new Segment(0.050000,63.989032,0.000000,63.989782,43.716439,14.945791,0.000000,0.000000),
			new Segment(0.050000,66.193536,0.000000,66.194286,44.463729,14.945791,0.000000,0.000000),
			new Segment(0.050000,68.435405,0.000000,68.436155,45.211018,14.945791,-0.000000,0.000000),
			new Segment(0.050000,70.714638,0.000000,70.715388,45.958308,14.945791,0.000000,0.000000),
			new Segment(0.050000,73.031236,0.000000,73.031986,46.705597,14.945791,-0.000000,0.000000),
			new Segment(0.050000,75.381834,0.000000,75.382834,47.328339,12.454826,-49.819304,0.000000),
			new Segment(0.050000,77.760706,0.000000,77.761706,47.826532,9.963861,-49.819304,0.000000),
			new Segment(0.050000,80.161373,0.000000,80.162373,48.200176,7.472896,-49.819304,0.000000),
			new Segment(0.050000,82.577610,0.000000,82.578610,48.449273,4.981930,-49.819304,0.000000),
			new Segment(0.050000,85.003187,0.000000,85.004187,48.573821,2.490965,-49.819304,0.000000),
			new Segment(0.050000,87.431147,0.000000,87.432147,48.544564,-0.585140,-61.522114,0.000000),
			new Segment(0.050000,89.854530,0.000000,89.855530,48.390759,-3.076106,-49.819304,0.000000),
			new Segment(0.050000,92.267109,0.000000,92.268109,48.112405,-5.567071,-49.819304,0.000000),
			new Segment(0.050000,94.662657,0.000000,94.663657,47.709504,-8.058036,-49.819304,0.000000),
			new Segment(0.050000,97.034945,0.000000,97.035945,47.182053,-10.549001,-49.819304,0.000000),
			new Segment(0.050000,99.377748,0.000000,99.378748,46.530055,-13.039966,-49.819304,0.000000),
			new Segment(0.050000,101.684746,0.019215,101.686569,45.782766,-14.945791,-38.116494,0.022118),
			new Segment(0.050000,103.953798,0.097518,103.957025,45.035476,-14.945791,0.000000,0.045758),
			new Segment(0.050000,106.183512,0.219793,106.190116,44.288186,-14.945791,-0.000000,0.062848),
			new Segment(0.050000,108.374005,0.371145,108.385843,43.540897,-14.945791,0.000000,0.074270),
			new Segment(0.050000,110.525826,0.539013,110.544206,42.793607,-14.945791,-0.000000,0.080661),
			new Segment(0.050000,112.639709,0.712589,112.665204,42.046318,-14.945791,0.000000,0.082465),
			new Segment(0.050000,114.716414,0.882365,114.748838,41.299028,-14.945791,-0.000000,0.079970),
			new Segment(0.050000,116.756616,1.039780,116.795107,40.551739,-14.945791,0.000000,0.073335),
			new Segment(0.050000,118.760823,1.176939,118.804012,39.804449,-14.945791,0.000000,0.062607),
			new Segment(0.050000,120.729305,1.286389,120.775552,39.057160,-14.945791,-0.000000,0.047735),
			new Segment(0.050000,122.662014,1.360937,122.709728,38.309870,-14.945791,-0.000000,0.028578),
			new Segment(0.050000,124.558501,1.393507,124.606539,37.562580,-14.945791,0.000000,0.004915),
			new Segment(0.050000,126.417812,1.377037,126.465986,36.815291,-14.945791,-0.000000,6.259630),
			new Segment(0.050000,128.238361,1.304415,128.288068,36.068001,-14.945791,0.000000,6.225994),
			new Segment(0.050000,130.017779,1.168480,130.072786,35.320712,-14.945791,0.000000,6.186787),
			new Segment(0.050000,131.752752,0.962099,131.820139,34.573422,-14.945791,-0.000000,6.141600),
			new Segment(0.050000,133.438846,0.678368,133.530128,33.826133,-14.945791,0.000000,6.090071),
			new Segment(0.050000,135.070375,0.310948,135.202752,33.078843,-14.945791,-0.000000,6.031972),
			new Segment(0.050000,136.640369,-0.145411,136.838012,32.331554,-14.945791,-0.000000,5.967319),
			new Segment(0.050000,138.140718,-0.694188,138.435908,31.584264,-14.945791,0.000000,5.896502),
			new Segment(0.050000,139.562595,-1.336329,139.996439,30.836974,-14.945791,-0.000000,5.820389),
			new Segment(0.050000,140.897197,-2.069566,141.519605,30.089685,-14.945791,-0.000000,5.740373),
			new Segment(0.050000,142.136733,-2.888051,143.005407,29.342395,-14.945791,0.000000,5.658294),
			new Segment(0.050000,143.275466,-3.782523,144.453845,28.595106,-14.945791,-0.000000,5.576232),
			new Segment(0.050000,144.310509,-4.741038,145.864918,27.847816,-14.945791,0.000000,5.496224),
			new Segment(0.050000,145.242139,-5.750110,147.238626,27.100527,-14.945791,-0.000000,5.419986),
			new Segment(0.050000,146.073581,-6.795941,148.574970,26.353237,-14.945791,0.000000,5.348745),
			new Segment(0.050000,146.810389,-7.865455,149.873950,25.605948,-14.945791,-0.000000,5.283200),
			new Segment(0.050000,147.459646,-8.946966,151.135565,24.858658,-14.945791,0.000000,5.223589),
			new Segment(0.050000,148.029217,-10.030487,152.359816,24.111368,-14.945791,-0.000000,5.169804),
			new Segment(0.050000,148.527135,-11.107753,153.546702,23.364079,-14.945791,0.000000,5.121517),
			new Segment(0.050000,148.961187,-12.172080,154.696224,22.616789,-14.945791,-0.000000,5.078284),
			new Segment(0.050000,149.338660,-13.218146,155.808381,21.869500,-14.945791,0.000000,5.039613),
			new Segment(0.050000,149.666217,-14.241753,156.883174,21.122210,-14.945791,0.000000,5.005015),
			new Segment(0.050000,149.949856,-15.239611,157.920602,20.374921,-14.945791,0.000000,4.974030),
			new Segment(0.050000,150.194924,-16.209149,158.920666,19.627631,-14.945791,-0.000000,4.946240),
			new Segment(0.050000,150.406160,-17.148362,159.883365,18.880342,-14.945791,-0.000000,4.921271),
			new Segment(0.050000,150.587746,-18.055685,160.808700,18.133052,-14.945791,0.000000,4.898795),
			new Segment(0.050000,150.743369,-18.929897,161.696670,17.385762,-14.945791,0.000000,4.878528),
			new Segment(0.050000,150.876279,-19.770043,162.547276,16.638473,-14.945791,-0.000000,4.860221),
			new Segment(0.050000,150.989339,-20.575377,163.360518,15.891183,-14.945791,0.000000,4.843660),
			new Segment(0.050000,151.085076,-21.345318,164.136395,15.143894,-14.945791,-0.000000,4.828660),
			new Segment(0.050000,151.165721,-22.079408,164.874907,14.396604,-14.945791,0.000000,4.815062),
			new Segment(0.050000,151.233249,-22.777292,165.576055,13.649315,-14.945791,-0.000000,4.802727),
			new Segment(0.050000,151.289407,-23.438692,166.239838,12.902025,-14.945791,0.000000,4.791535),
			new Segment(0.050000,151.335743,-24.063393,166.866257,12.154736,-14.945791,-0.000000,4.781384),
			new Segment(0.050000,151.373632,-24.651225,167.455312,11.407446,-14.945791,0.000000,4.772182),
			new Segment(0.050000,151.404293,-25.202061,168.007002,10.660156,-14.945791,-0.000000,4.763851),
			new Segment(0.050000,151.428807,-25.715801,168.521328,9.912867,-14.945791,0.000000,4.756325),
			new Segment(0.050000,151.448132,-26.192369,168.998289,9.165577,-14.945791,0.000000,4.749544),
			new Segment(0.050000,151.463119,-26.631710,169.437885,8.418288,-14.945791,-0.000000,4.743456),
			new Segment(0.050000,151.474516,-27.033780,169.840117,7.670998,-14.945791,0.000000,4.738017),
			new Segment(0.050000,151.482982,-27.398549,170.204985,6.923709,-14.945791,-0.000000,4.733189),
			new Segment(0.050000,151.489095,-27.725995,170.532488,6.176419,-14.945791,0.000000,4.728938),
			new Segment(0.050000,151.493358,-28.016102,170.822627,5.429130,-14.945791,0.000000,4.725235),
			new Segment(0.050000,151.496203,-28.268860,171.075401,4.681840,-14.945791,-0.000000,4.722058),
			new Segment(0.050000,151.497997,-28.484263,171.290811,3.934550,-14.945791,-0.000000,4.719384),
			new Segment(0.050000,151.499047,-28.662305,171.468856,3.187261,-14.945791,0.000000,4.717198),
			new Segment(0.050000,151.499603,-28.802984,171.609537,2.439971,-14.945791,0.000000,4.715485),
			new Segment(0.050000,151.499860,-28.907032,171.713585,1.721939,-14.360651,11.702810,4.714226),
			new Segment(0.050000,151.499960,-28.978292,171.784845,1.128454,-11.869685,49.819304,4.713369),
			new Segment(0.050000,151.499992,-29.022991,171.829544,0.659518,-9.378720,49.819304,4.712832),
			new Segment(0.050000,151.499999,-29.047357,171.853910,0.315131,-6.887755,49.819304,4.712540),
			new Segment(0.050000,151.500000,-29.057618,171.864171,0.095291,-4.396790,49.819304,4.712417),
			new Segment(0.050000,151.500000,-29.060000,171.866553,0.000000,-1.905825,49.819304,4.712389),
			new Segment(0.050000,151.500000,-29.060000,171.866553,0.000000,0.000000,38.116494,4.712389)
	};
	
}

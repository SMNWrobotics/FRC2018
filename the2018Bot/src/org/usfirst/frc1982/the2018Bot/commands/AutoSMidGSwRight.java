package org.usfirst.frc1982.the2018Bot.commands;

import org.usfirst.frc1982.the2018Bot.Robot;
import org.usfirst.frc1982.the2018Bot.RobotMap;

import edu.wpi.first.wpilibj.command.Command;
import edu.wpi.first.wpilibj.smartdashboard.SmartDashboard;
import jaci.pathfinder.Pathfinder;
import jaci.pathfinder.Trajectory;
import jaci.pathfinder.Waypoint;
import jaci.pathfinder.Trajectory.Segment;
import jaci.pathfinder.followers.EncoderFollower;

public class AutoSMidGSwRight extends Command {
	
//	new Waypoint(0,0,0),
//	new Waypoint(105.5,-59.0,0.0)
	
	EncoderFollower left;
	EncoderFollower right;
	
	@Override
	protected void initialize() {
		Trajectory trajectory;
		double max_velocity = 100; 
		
		trajectory = new Trajectory(segs); 
		
		EncoderFollower[] result = AutoUtil.getPath(trajectory, max_velocity);
		
		left = result[0];
		right = result[1];
		
	}
	
	@Override
	protected void execute() {
		//7.44 is magic number determined by rotating wheel about 1 revolution
		int lpos = (int) Math.round(RobotMap.driveLeft.getSelectedSensorPosition(0));
		int rpos = (int) Math.round(RobotMap.driveRight.getSelectedSensorPosition(0));
		double l = left.calculate(lpos);
	    double r = right.calculate(rpos);
	    
	    double turn = 0.0;
	    double gyro_heading = -Robot.gyro.getAngleZ()/4; // Assuming the gyro is giving a value in degrees
	    if (Robot.gyroValid) {
		    double desired_heading = Pathfinder.r2d(left.getHeading());  // Should also be in degrees
		    
		    double angleDifference = Pathfinder.boundHalfDegrees(desired_heading - gyro_heading);
		    turn = 0.8 * (-1.0/80.0) * angleDifference;
		    
		    SmartDashboard.putNumber("Gyro Angle", gyro_heading);
		    SmartDashboard.putNumber("Desired Heading", desired_heading);
	    }
	    System.out.println("Lencoder: " + (lpos/30759*6) + " Rencoder: " + rpos + " Left output: " + l + " Right output: " + r);// + " desired heading: " + desired_heading);
	    
	    RobotMap.driveLeft.set(l + turn);
//	    RobotMap.driveleftSlave.set(l + turn);
	    RobotMap.driveRight.set(r - turn);
//    	RobotMap.driverightSlave.set(r - turn);
	}
	
	@Override
	protected boolean isFinished() {
		// TODO Auto-generated method stub
		return false;
	}
	
	@Override
	protected void end() {
		
	}
	
	@Override
	protected void interrupted() {
		
	}
	
	private Segment[] segs = {
			new Segment(0.050000,0.001723,-0.000000,0.003108,0.124335,2.486700,49.733997,6.283153),
			new Segment(0.050000,0.014157,-0.000002,0.015542,0.373005,4.973400,49.733997,6.282924),
			new Segment(0.050000,0.042132,-0.000016,0.043517,0.746010,7.460099,49.733997,6.282407),
			new Segment(0.050000,0.091866,-0.000078,0.093251,1.243350,9.946799,49.733997,6.281489),
			new Segment(0.050000,0.169575,-0.000266,0.170961,1.865025,12.433499,49.733997,6.280051),
			new Segment(0.050000,0.281476,-0.000732,0.282862,2.611035,14.920199,49.733997,6.277978),
			new Segment(0.050000,0.430675,-0.001716,0.432064,3.357045,14.920199,-0.000000,6.275209),
			new Segment(0.050000,0.617168,-0.003527,0.618567,4.103055,14.920199,0.000000,6.271737),
			new Segment(0.050000,0.840951,-0.006556,0.842370,4.849065,14.920199,-0.000000,6.267558),
			new Segment(0.050000,1.102011,-0.011275,1.103473,5.595075,14.920199,0.000000,6.262664),
			new Segment(0.050000,1.400333,-0.018235,1.401877,6.341085,14.920199,-0.000000,6.257047),
			new Segment(0.050000,1.735893,-0.028073,1.737582,7.087095,14.920199,0.000000,6.250698),
			new Segment(0.050000,2.108655,-0.041509,2.110586,7.833104,14.920199,0.000000,6.243608),
			new Segment(0.050000,2.518572,-0.059349,2.520892,8.579114,14.920199,0.000000,6.235767),
			new Segment(0.050000,2.965578,-0.082487,2.968498,9.325124,14.920199,-0.000000,6.227164),
			new Segment(0.050000,3.449589,-0.111905,3.453404,10.071134,14.920199,0.000000,6.217789),
			new Segment(0.050000,3.970498,-0.148674,3.975611,10.817144,14.920199,-0.000000,6.207631),
			new Segment(0.050000,4.528167,-0.193958,4.535119,11.563154,14.920199,0.000000,6.196683),
			new Segment(0.050000,5.122427,-0.249007,5.131927,12.309164,14.920199,0.000000,6.184934),
			new Segment(0.050000,5.753071,-0.315165,5.766035,13.055174,14.920199,0.000000,6.172378),
			new Segment(0.050000,6.419847,-0.393864,6.437444,13.801184,14.920199,-0.000000,6.159010),
			new Segment(0.050000,7.122454,-0.486622,7.146154,14.547194,14.920199,0.000000,6.144828),
			new Segment(0.050000,7.860536,-0.595041,7.892164,15.293204,14.920199,0.000000,6.129833),
			new Segment(0.050000,8.633677,-0.720802,8.675474,16.039214,14.920199,-0.000000,6.114028),
			new Segment(0.050000,9.441392,-0.865659,9.496085,16.785224,14.920199,0.000000,6.097424),
			new Segment(0.050000,10.283124,-1.031432,10.353996,17.531234,14.920199,-0.000000,6.080035),
			new Segment(0.050000,11.158239,-1.219994,11.249208,18.277244,14.920199,0.000000,6.061882),
			new Segment(0.050000,12.066021,-1.433266,12.181721,19.023254,14.920199,-0.000000,6.042991),
			new Segment(0.050000,13.005671,-1.673195,13.151534,19.769264,14.920199,0.000000,6.023397),
			new Segment(0.050000,13.976301,-1.941747,14.158647,20.515274,14.920199,-0.000000,6.003142),
			new Segment(0.050000,14.976940,-2.240883,15.203061,21.261284,14.920199,0.000000,5.982278),
			new Segment(0.050000,16.006533,-2.572545,16.284776,22.007293,14.920199,0.000000,5.960863),
			new Segment(0.050000,17.063947,-2.938633,17.403790,22.753303,14.920199,-0.000000,5.938965),
			new Segment(0.050000,18.147977,-3.340986,18.560106,23.499313,14.920199,0.000000,5.916659),
			new Segment(0.050000,19.257360,-3.781357,19.753722,24.245323,14.920199,-0.000000,5.894031),
			new Segment(0.050000,20.390784,-4.261400,20.984638,24.991333,14.920199,0.000000,5.871169),
			new Segment(0.050000,21.546902,-4.782642,22.252855,25.737343,14.920199,-0.000000,5.848171),
			new Segment(0.050000,22.724357,-5.346469,23.558373,26.483353,14.920199,-0.000000,5.825138),
			new Segment(0.050000,23.921792,-5.954111,24.901190,27.229363,14.920199,0.000000,5.802176),
			new Segment(0.050000,25.137880,-6.606625,26.281309,27.975373,14.920199,-0.000000,5.779391),
			new Segment(0.050000,26.371338,-7.304889,27.698728,28.721383,14.920199,0.000000,5.756891),
			new Segment(0.050000,27.620954,-8.049592,29.153447,29.467393,14.920199,-0.000000,5.734782),
			new Segment(0.050000,28.885605,-8.841233,30.645467,30.213403,14.920199,-0.000000,5.713168),
			new Segment(0.050000,30.164279,-9.680118,32.174787,30.959413,14.920199,0.000000,5.692150),
			new Segment(0.050000,31.456094,-10.566363,33.741408,31.705423,14.920199,0.000000,5.671824),
			new Segment(0.050000,32.760313,-11.499902,35.345330,32.451433,14.920199,-0.000000,5.652280),
			new Segment(0.050000,34.076363,-12.480484,36.986552,33.197443,14.920199,0.000000,5.633603),
			new Segment(0.050000,35.403844,-13.507693,38.665074,33.943453,14.920199,-0.000000,5.615874),
			new Segment(0.050000,36.742543,-14.580943,40.380897,34.689463,14.920199,-0.000000,5.599165),
			new Segment(0.050000,38.092439,-15.699495,42.134020,35.435473,14.920199,0.000000,5.583547),
			new Segment(0.050000,39.453718,-16.862458,43.924444,36.181483,14.920199,-0.000000,5.569083),
			new Segment(0.050000,40.826773,-18.068795,45.752168,36.927492,14.920199,0.000000,5.555834),
			new Segment(0.050000,42.212212,-19.317327,47.617193,37.673502,14.920199,-0.000000,5.543859),
			new Segment(0.050000,43.610867,-20.606735,49.519519,38.419512,14.920199,0.000000,5.533215),
			new Segment(0.050000,45.023794,-21.935553,51.459145,39.165522,14.920199,-0.000000,5.523960),
			new Segment(0.050000,46.450045,-23.300011,53.432963,39.787197,12.433499,-49.733997,5.516162),
			new Segment(0.050000,47.886741,-24.693951,55.434756,40.284537,9.946799,-49.733997,5.509892),
			new Segment(0.050000,49.331312,-26.110980,57.458308,40.657542,7.460099,-49.733997,5.505205),
			new Segment(0.050000,50.781431,-27.544527,59.497402,40.906212,4.973400,-49.733997,5.502139),
			new Segment(0.050000,52.234949,-28.987892,61.545821,41.030547,2.486700,-49.733997,5.500722),
			new Segment(0.050000,53.689179,-30.433662,63.596439,40.994166,-0.727618,-64.286351,5.500964),
			new Segment(0.050000,55.141458,-31.874403,65.642129,40.833450,-3.214318,-49.733997,5.502863),
			new Segment(0.050000,56.589717,-33.303360,67.676675,40.548400,-5.701017,-49.733997,5.506403),
			new Segment(0.050000,58.031760,-34.713870,69.693861,40.139014,-8.187717,-49.733997,5.511554),
			new Segment(0.050000,59.465196,-36.099409,71.687468,39.605293,-10.674417,-49.733997,5.518271),
			new Segment(0.050000,60.887368,-37.453650,73.651282,38.947237,-13.161117,-49.733997,5.526497),
			new Segment(0.050000,62.295962,-38.771134,75.579993,38.201227,-14.920199,-35.181642,5.536160),
			new Segment(0.050000,63.690611,-40.048769,77.471404,37.455217,-14.920199,-0.000000,5.547195),
			new Segment(0.050000,65.072308,-41.285133,79.325515,36.709207,-14.920199,0.000000,5.559544),
			new Segment(0.050000,66.441817,-42.478948,81.142325,35.963197,-14.920199,0.000000,5.573150),
			new Segment(0.050000,67.799683,-43.629076,82.921835,35.217187,-14.920199,-0.000000,5.587954),
			new Segment(0.050000,69.146240,-44.734523,84.664044,34.471177,-14.920199,0.000000,5.603894),
			new Segment(0.050000,70.481612,-45.794441,86.368952,33.725167,-14.920199,0.000000,5.620905),
			new Segment(0.050000,71.805721,-46.808135,88.036560,32.979157,-14.920199,0.000000,5.638915),
			new Segment(0.050000,73.118300,-47.775068,89.666868,32.233147,-14.920199,0.000000,5.657849),
			new Segment(0.050000,74.418897,-48.694871,91.259875,31.487138,-14.920199,-0.000000,5.677627),
			new Segment(0.050000,75.706890,-49.567346,92.815582,30.741128,-14.920199,0.000000,5.698162),
			new Segment(0.050000,76.981497,-50.392480,94.333988,29.995118,-14.920199,-0.000000,5.719360),
			new Segment(0.050000,78.241799,-51.170444,95.815094,29.249108,-14.920199,0.000000,5.741125),
			new Segment(0.050000,79.486748,-51.901599,97.258899,28.503098,-14.920199,0.000000,5.763356),
			new Segment(0.050000,80.715195,-52.586500,98.665403,27.757088,-14.920199,0.000000,5.785947),
			new Segment(0.050000,81.925905,-53.225892,100.034607,27.011078,-14.920199,-0.000000,5.808792),
			new Segment(0.050000,83.117579,-53.820704,101.366511,26.265068,-14.920199,0.000000,5.831783),
			new Segment(0.050000,84.288880,-54.372045,102.661114,25.519058,-14.920199,0.000000,5.854814),
			new Segment(0.050000,85.438449,-54.881192,103.918417,24.773048,-14.920199,-0.000000,5.877780),
			new Segment(0.050000,86.564930,-55.349573,105.138419,24.027038,-14.920199,0.000000,5.900581),
			new Segment(0.050000,87.666986,-55.778755,106.321121,23.281028,-14.920199,-0.000000,5.923123),
			new Segment(0.050000,88.743317,-56.170419,107.466522,22.535018,-14.920199,0.000000,5.945316),
			new Segment(0.050000,89.792676,-56.526349,108.574622,21.789008,-14.920199,-0.000000,5.967079),
			new Segment(0.050000,90.813877,-56.848401,109.645423,21.042998,-14.920199,0.000000,5.988338),
			new Segment(0.050000,91.805810,-57.138490,110.678922,20.296988,-14.920199,0.000000,6.009029),
			new Segment(0.050000,92.767445,-57.398565,111.675121,19.550978,-14.920199,0.000000,6.029094),
			new Segment(0.050000,93.697833,-57.630590,112.634020,18.804968,-14.920199,-0.000000,6.048486),
			new Segment(0.050000,94.596114,-57.836527,113.555618,18.058958,-14.920199,0.000000,6.067165),
			new Segment(0.050000,95.461512,-58.018316,114.439916,17.312948,-14.920199,-0.000000,6.085097),
			new Segment(0.050000,96.293336,-58.177865,115.286913,16.566939,-14.920199,0.000000,6.102259),
			new Segment(0.050000,97.090974,-58.317034,116.096610,15.820929,-14.920199,-0.000000,6.118630),
			new Segment(0.050000,97.853890,-58.437623,116.869006,15.074919,-14.920199,0.000000,6.134199),
			new Segment(0.050000,98.581622,-58.541366,117.604102,14.328909,-14.920199,0.000000,6.148957),
			new Segment(0.050000,99.273770,-58.629920,118.301897,13.582899,-14.920199,-0.000000,6.162901),
			new Segment(0.050000,99.929994,-58.704865,118.962392,12.836889,-14.920199,0.000000,6.176032),
			new Segment(0.050000,100.550009,-58.767693,119.585586,12.090879,-14.920199,0.000000,6.188351),
			new Segment(0.050000,101.133577,-58.819809,120.171479,11.344869,-14.920199,0.000000,6.199866),
			new Segment(0.050000,101.680501,-58.862532,120.720073,10.598859,-14.920199,-0.000000,6.210583),
			new Segment(0.050000,102.190623,-58.897086,121.231365,9.852849,-14.920199,0.000000,6.220511),
			new Segment(0.050000,102.663814,-58.924607,121.705358,9.106839,-14.920199,-0.000000,6.229660),
			new Segment(0.050000,103.099973,-58.946141,122.142049,8.360829,-14.920199,0.000000,6.238039),
			new Segment(0.050000,103.499022,-58.962644,122.541440,7.614819,-14.920199,0.000000,6.245660),
			new Segment(0.050000,103.860902,-58.974984,122.903531,6.868809,-14.920199,0.000000,6.252533),
			new Segment(0.050000,104.185568,-58.983941,123.228321,6.122799,-14.920199,0.000000,6.258667),
			new Segment(0.050000,104.472989,-58.990212,123.515811,5.376789,-14.920199,-0.000000,6.264072),
			new Segment(0.050000,104.723143,-58.994407,123.766000,4.630779,-14.920199,0.000000,6.268757),
			new Segment(0.050000,104.936015,-58.997056,123.978889,3.884769,-14.920199,-0.000000,6.272728),
			new Segment(0.050000,105.111596,-58.998605,124.154477,3.138759,-14.920199,0.000000,6.275994),
			new Segment(0.050000,105.249882,-58.999422,124.292765,2.392750,-14.920199,0.000000,6.278560),
			new Segment(0.050000,105.351778,-58.999797,124.394662,1.683120,-14.192581,14.552354,6.280446),
			new Segment(0.050000,105.421301,-58.999943,124.464185,1.097826,-11.705881,49.733997,6.281732),
			new Segment(0.050000,105.464668,-58.999988,124.507553,0.636867,-9.219182,49.733997,6.282533),
			new Segment(0.050000,105.488096,-58.999999,124.530981,0.300243,-6.732482,49.733997,6.282966),
			new Segment(0.050000,105.497801,-59.000000,124.540685,0.087954,-4.245782,49.733997,6.283145),
			new Segment(0.050000,105.500000,-59.000000,124.542884,0.000000,-1.759082,49.733997,0.000000),
			new Segment(0.050000,105.500000,-59.000000,124.542884,0.000000,0.000000,35.181642,0.000000)
	};
	
}
